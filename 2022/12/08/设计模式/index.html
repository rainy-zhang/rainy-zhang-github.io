<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rainy-zhang.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="https://rainy-zhang.github.io/2022/12/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="Rainy&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-12-08T08:55:00.000Z">
<meta property="article:modified_time" content="2022-12-08T08:56:59.646Z">
<meta property="article:author" content="Rainy">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://rainy-zhang.github.io/2022/12/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>设计模式 | Rainy's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rainy's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rainy-zhang.github.io/2022/12/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rainy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rainy's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          设计模式
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-12-08 16:55:00 / 修改时间：16:56:59" itemprop="dateCreated datePublished" datetime="2022-12-08T16:55:00+08:00">2022-12-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">软件设计</span></a>
                </span>
            </span>

          
            <div class="post-description"> </div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="⭐工厂模式（Factory）"><a href="#⭐工厂模式（Factory）" class="headerlink" title="⭐工厂模式（Factory）"></a>⭐工厂模式（Factory）</h2><p>对象的创建逻辑比较复杂，就可以考虑使用工厂模式，把对象的创建过程和使用分开。</p>
<p>比如需要通过if-else动态创建不同的子类对象，就可以考虑把if-else的判断逻辑放到工厂类中。</p>
<p>比如单个对象本身的创建过程比较复杂，需要组合其它对象，做各种初始化操作，也可以把这些逻辑封装到工厂类中。</p>
<h3 id="⭐简单工厂"><a href="#⭐简单工厂" class="headerlink" title="⭐简单工厂"></a>⭐简单工厂</h3><p><strong>使用工厂模式实现解析不同格式的配置文件</strong>：</p>
<ol>
<li><p>定义工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParseFactory</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, IRuleConfigParser&gt; cachedParsers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		cachedParsers.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>());</span><br><span class="line">		cachedParsers.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>());</span><br><span class="line">		cachedParsers.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (configFormat == <span class="literal">null</span> || configFormat.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> cachedParser.get(configFormat);</span><br><span class="line">		<span class="keyword">return</span> parser;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigSource</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> RuleConfig <span class="title function_">load</span><span class="params">(String ruleConfigFilePath)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ruleConfigFileExtension</span> <span class="operator">=</span> getFileExtension(ruleConfigFilePath);</span><br><span class="line">        <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> RuleConfigParserFactory.createParser(ruleConfigFileExtension);</span><br><span class="line">        <span class="keyword">if</span> (parser == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidRuleConfigException</span>(<span class="string">&quot;Rule config file format is not support&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">configText</span> <span class="operator">=</span> getFileContent();</span><br><span class="line">        <span class="type">RuleConfig</span> <span class="variable">ruleConfig</span> <span class="operator">=</span> parser.parse(configText);</span><br><span class="line">        <span class="keyword">return</span> ruleConfig;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="comment">// ...获取文件拓展名，比如rule.json 返回json</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="⭐工厂方法"><a href="#⭐工厂方法" class="headerlink" title="⭐工厂方法"></a>⭐工厂方法</h3><p><strong>使用工厂模式实现解析不同格式的配置文件</strong>：</p>
<ol>
<li><p>定义工厂方法类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">	IRuleConfigParser <span class="title function_">createPraser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>具体的工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// json格式配置文件的工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xml格式配置文件的工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// yaml格式配置文件的工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YamlRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>聚合工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据文件名后缀创建不同的工厂对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParseFactory</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, IRuleConfigParserFactory&gt; cachedParsers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		cachedParsers.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParserFactory</span>());</span><br><span class="line">		cachedParsers.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParserFactory</span>());</span><br><span class="line">		cachedParsers.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParserFactory</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (configFormat == <span class="literal">null</span> || configFormat.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">IRuleConfigParserFactory</span> <span class="variable">parserFactory</span> <span class="operator">=</span> cachedParser.get(configFormat);</span><br><span class="line">		<span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> parserFactory.createParser();	<span class="comment">// 调用工厂方法获取具体的工厂类</span></span><br><span class="line">		<span class="keyword">return</span> parser;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据配置文件的后缀，将文件中的配置解析成内存对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigSource</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> RuleConfig <span class="title function_">load</span><span class="params">(String ruleConfigFilePath)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ruleConfigFileExtension</span> <span class="operator">=</span> getFileExtension(ruleConfigFilePath);</span><br><span class="line">        <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> RuleConfigParserFactory.createParser(ruleConfigFileExtension);</span><br><span class="line">        <span class="keyword">if</span> (parser == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidRuleConfigException</span>(<span class="string">&quot;Rule config file format is not support: &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">configText</span> <span class="operator">=</span> getFileContent();</span><br><span class="line">        <span class="type">RuleConfig</span> <span class="variable">ruleConfig</span> <span class="operator">=</span> parser.parse(configText);</span><br><span class="line">        <span class="keyword">return</span> ruleConfig;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="comment">// ...获取文件拓展名，比如rule.json 返回json</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="⭐抽象工厂"><a href="#⭐抽象工厂" class="headerlink" title="⭐抽象工厂"></a>⭐抽象工厂</h3><p>就是在工厂类中定义不同类型的对象的创建方式，可以减少工厂类的数量。</p>
<p><strong>使用工厂模式实现解析不同格式的配置文件</strong>：</p>
<ol>
<li><p>定义抽象工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 创建rule配置文件解析器工厂类</span></span><br><span class="line">	IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 创建system配置文件解析器工厂类</span></span><br><span class="line">	ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>抽象工厂实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">	<span class="comment">// 创建json格式的rule配置文件解析器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建json格式的system配置文件解析器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonSystemConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 创建xml格式的rule配置文件解析器</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建xml格式的system配置文件解析器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlSystemConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YamlConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 创建yaml格式的rule配置文件解析器</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建yaml格式的system配置文件解析器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">YamlSystemConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>聚合工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigParserFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, IConfigParserFactory&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        map.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonConfigParserFactory</span>());</span><br><span class="line">        map.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlConfigParserFactory</span>());</span><br><span class="line">        map.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlConfigParserFactory</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取rule配置文件解析器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (configFormat == <span class="literal">null</span> || configFormat.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="type">IConfigParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> map.get(configFormat);</span><br><span class="line">        <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.createRuleParser();</span><br><span class="line">        <span class="keyword">return</span> parser;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取system配置文件解析器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (configFormat == <span class="literal">null</span> || configFormat.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="type">IConfigParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> map.get(configFormat);</span><br><span class="line">        <span class="type">ISystemConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.createSystemParser();</span><br><span class="line">        <span class="keyword">return</span> parser;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="单例模式（Singleton）"><a href="#单例模式（Singleton）" class="headerlink" title="单例模式（Singleton）"></a>单例模式（Singleton）</h2><p><strong>单例模式就是一个类只允许创建一个实例</strong>。</p>
<p><strong>应用场景</strong>：</p>
<p>比如有些数据在系统中只应保存一份，就比较适合设计成单例类，比如用来保存系统配置的类，就比较适合设计成单例类。</p>
<p>比如某些系统中会缓存一些变动不太频繁的冷数据，通常就是在类中声明一些集合类型的成员变量用来缓存数据，这种也比较适合设计成单例类。</p>
<p>单例模式根据不同的创建方式，可以分细为五类：<strong>饿汉式、懒汉式、双重检测、静态内部类、枚举</strong>。</p>
<h3 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a>饿汉式</h3><p><strong>饿汉式就是在类加载的时候，就开始创建实例并初始化，这样的创建过程是线程安全的</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">singleton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> singleton;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有些人认为提前初始化实例是一种浪费资源的行为，应该等用到的时候再去初始化，不过如果初始化的逻辑比较复杂，耗时比较长，这就会影响到系统的性能。</p>
<p>用饿汉式把一些耗时的操作，提前到程序启动的时候完成，这样就能避免初始化的性能问题。</p>
<h3 id="懒汉式"><a href="#懒汉式" class="headerlink" title="懒汉式"></a>懒汉式</h3><p><strong>懒汉式可以实现延迟加载，就是在用到的时候，才去创建实例并初始化</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">			singleton = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> singleton;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是在多线程环境中，饿汉式就需要通过加锁来确保只会创建一个实例，如果这个类经常被调用，就会导致频繁的加锁和解锁，会影响到系统的性能。</p>
<h3 id="双重检测机制"><a href="#双重检测机制" class="headerlink" title="双重检测机制"></a><b id='双重检测机制'>双重检测机制</b></h3><p>双重检测也可以实现延迟加载，主要是为了解决，多线程环境下懒汉式并发度很低的问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span>(Singleton.class) &#123;	<span class="comment">// 对Singleton这个类加锁，会锁住所有singleton对象</span></span><br><span class="line">				<span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">					singleton = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> singleton;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为指令重排，可能会导致Singleton对象被new出来之后，还没来得及初始化，就被使用了。这个问题可以通过给成员变量加上volatile关键字，禁止指令重排。</p>
<p>实际上这个问题只有很低的JDK版本才会有，高版本的JDK内部已经解决了这个问题，就是把创建对象的new操作，和初始化操作设计为原子操作，就可以禁止指令重排。</p>
<h3 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h3><p><strong>静态内部类这种方式也可以实现延迟加载</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;	<span class="comment">// 私有构造方法</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;	<span class="comment">// 创建静态内部类</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">singleton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();	<span class="comment">// 在静态内部类中创建实例</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> SingletonHolder.singleton;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态内部类就是在类中定义一个静态内部类，在这个内部类中定义初始化的逻辑。当外部类被加载的时候，并不会创建内部类的实例对象，只有调用getInstance()方法的时候，内部类才会被加载，这个时候才会创建外部类的实例对象。</p>
<p>这个创建过程是由JVM来完成的，是线程安全的，也可以实现延迟加载。</p>
<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p>基于枚举来实现单例，是最简单的一种方式了，就是通过Java枚举本身的特点，来保证实例创建的线程安全性和实例唯一性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">	INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="⭐建造者模式（Builder）"><a href="#⭐建造者模式（Builder）" class="headerlink" title="⭐建造者模式（Builder）"></a>⭐建造者模式（Builder）</h2><p>建造者模式主要是用来创建一些比较复杂的对象。</p>
<h3 id="数据填充和校验"><a href="#数据填充和校验" class="headerlink" title="数据填充和校验"></a>数据填充和校验</h3><p>如果一个类中有很多属性，有些属性是必填的，有些是非必填的。比较简单的做法就是把必填属性放在构造函数中，其它非必填的用set()方法设置。如果必填的属性有很多，就会导致构造函数参数列表很长，使用起来就很容易出错。</p>
<ol>
<li><p>写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourcePoolConfig</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> maxTotal;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> maxIdle;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> minIdle;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">ResourcePoolConfig</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.name = builder.name;</span><br><span class="line">		<span class="built_in">this</span>.maxTotal = builder.maxTotal;</span><br><span class="line">		<span class="built_in">this</span>.maxIdle = builder.maxIdle;</span><br><span class="line">		<span class="built_in">this</span>.minIdle = builder.minIdle;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 通过Builder内部类完成属性填充</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> String name;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> maxTotal;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> maxIdle;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> minIdle;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> ResourcePoolConfig <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// 对属性做校验</span></span><br><span class="line">			<span class="keyword">if</span> (StringUtils.isBlank(name)) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;name can&#x27;t be empty&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResourcePoolConfig</span>(<span class="built_in">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.name = name;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">setMaxTotal</span><span class="params">(<span class="type">int</span> maxTotal)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.maxTotal = maxTotal;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">setMaxIdle</span><span class="params">(<span class="type">int</span> maxIdle)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.maxIdle = maxIdle;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">setMinIdle</span><span class="params">(<span class="type">int</span> minIdle)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.minIdle = minIdle;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">ResourcePoolConfig</span> <span class="variable">config</span> <span class="operator">=</span> ResourcePoolConfig.Builder()</span><br><span class="line">                            .setName(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">                            .setMaxTotal(<span class="number">10</span>)</span><br><span class="line">                            .setMaxIdle(<span class="number">5</span>)</span><br><span class="line">                            .setMinIdle(<span class="number">2</span>)</span><br><span class="line">                            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="原型模式（Property）"><a href="#原型模式（Property）" class="headerlink" title="原型模式（Property）"></a>原型模式（Property）</h2><p><strong>如果一个对象的创建成本比较大，并且存在其它大部分字段都相同的对象，这种情况可以利用已有的对象，通过复制的方式来创建新的对象，这就叫原型模式</strong>。</p>
<p>原型模式有两种实现方法，深拷贝和浅拷贝。</p>
<ul>
<li>浅拷贝只会复制对象中基本数据类型和引用对象的内存地址，不会递归的复制引用对象，以及引用对象的引用对象…。</li>
<li>深拷贝得到的是一份完全独立的对象，所以深拷贝会更加耗时，更耗内存空间。</li>
</ul>
<h3 id="实现缓存功能"><a href="#实现缓存功能" class="headerlink" title="实现缓存功能"></a>实现缓存功能</h3><p>很多时候我们会在系统启动的时候，从数据库中加载一些数据到内存中，用来做缓存。为了保证缓存中数据的正确性，通常会定期更新内存中的数据，这个时候就可以利用原型模式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Property</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> ConcurrentHashMap&lt;String, SearchWorld&gt; currentKeywords = <span class="keyword">new</span> <span class="title class_">CurrentHashMap</span>&lt;String, SearchWorld&gt;();</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> <span class="variable">lastUpdateTime</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 刷新缓存</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> &#123;</span><br><span class="line">		HashMap&lt;String, SearchWord&gt; newKeywords = (HashMap&lt;String, SearchWord&gt;) currentKeywods.clone();</span><br><span class="line">		<span class="comment">// 从数据库中查询发生变更的数据（更新时间 &gt; lastUpdateTime），放入到newKeywords中</span></span><br><span class="line">		List&lt;SearchWord&gt; toBeUpdatedSearchWords = getSearchWordFromDB(lastUpdateTime);</span><br><span class="line">		<span class="type">long</span> <span class="variable">maxNewUpdateTime</span> <span class="operator">=</span> lastUpdateTime;</span><br><span class="line">		<span class="keyword">for</span> (SearchWord searchWord : toBeUpdatedSearchWords) &#123;</span><br><span class="line">			<span class="keyword">if</span> (searchWord.getLastUpdateTime &gt; maxNewLastUpdateTime) &#123;</span><br><span class="line">				maxNewLastUpdateTime = searchWord.getLastUpdateTime();</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">// 删除旧数据</span></span><br><span class="line">			<span class="keyword">if</span> (newKeywods.containsKey(searchWord.getKeyword())) &#123;</span><br><span class="line">				newKeywods.remove(searchWord.getKeyword(), searchWord);</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">// 覆盖掉原来的对象</span></span><br><span class="line">			newKeywods.put(searchWord.getKeyword(), searchWord);</span><br><span class="line">		&#125;</span><br><span class="line">		lastUpdateTime = maxNewLastUpdateTime;</span><br><span class="line">		currentKeywords = newKeywords;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 从数据库中查询更新时间&gt;lastUpdateTime的数据</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;SearchWord&gt; <span class="title function_">getSearchWordFromDB</span><span class="params">(<span class="type">long</span> lastUpdateTime)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="⭐代理模式（Proxy）"><a href="#⭐代理模式（Proxy）" class="headerlink" title="⭐代理模式（Proxy）"></a>⭐代理模式（Proxy）</h2><p><strong>就是在不修改原代码的情况下，通过代理类来给原始类附加额外的功能</strong>。</p>
<p>代理模式又分为：静态代理和动态代理。</p>
<h3 id="⭐静态代理"><a href="#⭐静态代理" class="headerlink" title="⭐静态代理"></a>⭐静态代理</h3><p>为每个类都创建一个代理类，并且每个代理类都要把原始类中的方法实现一遍，再附加一些额外的代理逻辑。</p>
<ol>
<li><p>原始类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">		<span class="comment">// 登录逻辑...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>代理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerProxy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserController userController;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserControllerProxy</span><span class="params">(UserController userController)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userController = userController;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">		<span class="comment">// 委托</span></span><br><span class="line">        userController.login(username, password);</span><br><span class="line">		<span class="comment">// 添加一些额外的逻辑，比如登录成功后发送短信通知</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">UserControllerProxy</span> <span class="variable">userControllerProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserControllerProxy</span>(<span class="keyword">new</span> <span class="title class_">UserController</span>());</span><br><span class="line">	userControllerProxy.login(<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="⭐动态代理"><a href="#⭐动态代理" class="headerlink" title="⭐动态代理"></a>⭐动态代理</h3><p>就是不预先为每个类创建代理类，而是在运行的时候，动态的创建原始类对应的代理类，然后在系统中用代理类替换掉原始类。</p>
<p><strong>Java可以通过InvocationHandler接口和Proxy类来实现动态代理</strong>：</p>
<ol>
<li><p>代理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProxy</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">createProxy</span><span class="params">(Object proxyObject)</span> &#123;</span><br><span class="line">		Class&lt;?&gt;[] interfaces = proxyObject.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">// 创建动态代理处理器</span></span><br><span class="line">		<span class="type">DynamicProxyHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicProxyHandler</span>(proxyObject);</span><br><span class="line">        <span class="comment">// 创建代理类</span></span><br><span class="line">		<span class="keyword">return</span> Proxy.newProxyInstance(proxyObject.getClass().getClassLoader(), interfaces);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>动态代理处理器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Object proxyObject;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">DynamicProxyHandler</span><span class="params">(Object proxyObject)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.proxyObject = proxyObject;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> &#123;</span><br><span class="line">		<span class="comment">// 代理逻辑...</span></span><br><span class="line">		<span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(proxyObject, args);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">UserProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserProxy</span>();</span><br><span class="line">	<span class="type">UserController</span> <span class="variable">userController</span> <span class="operator">=</span> (UserController) proxy.createProxy(<span class="keyword">new</span> <span class="title class_">UserController</span>())</span><br><span class="line">	userController.login();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐桥接模式（Bridge）"><a href="#⭐桥接模式（Bridge）" class="headerlink" title="⭐桥接模式（Bridge）"></a>⭐桥接模式（Bridge）</h2><p>将抽象部分和实现部分分离，让它们都可以独立的变化。</p>
<h3 id="⭐消息推送功能"><a href="#⭐消息推送功能" class="headerlink" title="⭐消息推送功能"></a>⭐消息推送功能</h3><ol>
<li><p>创建消息推送接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>消息推送实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以短信的方式发送消息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TelephoneMsgSender</span> <span class="keyword">implements</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; telephones;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">		<span class="comment">// 发送短信逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以邮件的方式发送消息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailMsgSender</span> <span class="keyword">implements</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; emails;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">		<span class="comment">// 发送邮件逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以微信的方式发送消息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMsgSender</span> <span class="keyword">implements</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; wechats;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">		<span class="comment">// 发送微信逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建桥接类，根据消息的紧急程度，将消息发送到不同渠道（不同紧急程度的消息和发送渠道的对应关系，可以动态配置）</p>
<ol>
<li><p>定义消息通知抽象类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">    <span class="comment">// 消息发送渠道</span></span><br><span class="line">	<span class="keyword">protected</span> MsgSender msgSender;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Notification</span><span class="params">(MsgSender msgSender)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.msgSender = msgSender;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>消息通知具体实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 严重通知级别</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SevereNotification</span> <span class="keyword">extends</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">SevereNotification</span><span class="params">(MsgSender msgSender)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>(msgSender);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">		msgSender.send(message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 紧急通知级别</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UrgencyNotification</span> <span class="keyword">extends</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">UrgencyNotification</span><span class="params">(MsgSender msgSender)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>(msgSender);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">		msgSender.send(message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">Notification</span> <span class="variable">notifiaction</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrgencyNotification</span>(<span class="keyword">new</span> <span class="title class_">EmailSender</span>());</span><br><span class="line">	notification.notify(<span class="string">&quot;这是一条紧急信息...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐装饰器模式（Decoreator）"><a href="#⭐装饰器模式（Decoreator）" class="headerlink" title="⭐装饰器模式（Decoreator）"></a>⭐装饰器模式（Decoreator）</h2><p><strong>装饰器模式跟代理模式的结构基本一样，只不过代理模式是为原始类增加一些额外的功能，装饰器模式是增强原始类现有的功能</strong>。</p>
<h3 id="⭐增强登录功能"><a href="#⭐增强登录功能" class="headerlink" title="⭐增强登录功能"></a>⭐增强登录功能</h3><ol>
<li><p>用户登录接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoginApi</span> &#123;</span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">login</span><span class="params">(String username, String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>原始类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> <span class="keyword">implements</span> <span class="title class_">LoginApi</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">		<span class="comment">// ...登录逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>发送邮件的装饰器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登陆成功后发送邮件的装饰器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginControllerWithSendEmail</span> <span class="keyword">implements</span> <span class="title class_">LoginApi</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoginApi loginApi;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmailSender</span>();	<span class="comment">// 发送邮件工具类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserControllerWithSendEmail</span><span class="params">(LoginApi loginApi)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.loginApi = loginApi;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> loginApi.login(username, password);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            <span class="comment">// 登陆成功，发送邮件</span></span><br><span class="line">	        sender.send(<span class="string">&quot;登陆成功...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>生成登录记录的装饰器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登陆成功后生成一条登录信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginControllerWithCreateRecord</span> <span class="keyword">implements</span> <span class="title class_">LoginApi</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoginApi loginApi;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">LoginRecordRepository</span> <span class="variable">loginRecordRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginRecordRepository</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginControllerWithCreateRecord</span><span class="params">(LoginApi loginApi)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.loginApi = loginApi;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> loginApi.login(username, password);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            <span class="comment">// 创建一条登录信息</span></span><br><span class="line">            <span class="type">LoginRecord</span> <span class="variable">loginRecord</span> <span class="operator">=</span> LoginRecord.builder()</span><br><span class="line">                .address(<span class="string">&quot;合肥&quot;</span>)</span><br><span class="line">                .ip(<span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">            loginRecordRepository.create(loginRecord);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">LoginApi</span> <span class="variable">loginApi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginControllerWithCreateRecord</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LoginControllerWithSendEmail</span>(</span><br><span class="line">        	<span class="keyword">new</span> <span class="title class_">LoginController</span>()</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    loginApi.login(<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐适配器模式（Adapter）"><a href="#⭐适配器模式（Adapter）" class="headerlink" title="⭐适配器模式（Adapter）"></a>⭐适配器模式（Adapter）</h2><p><strong>适配器模式就是用一个新类，把原来的类包装一下，用来解决两个不兼容的类可以在一起工作</strong>。</p>
<p>比如某个功能需要依赖多个外部系统，这些外部系统接口的参数和返回值格式都不一样，这时候就可以通过适配器模式，把它们的接口适配为统一的接口定义。</p>
<h3 id="⭐数据聚合功能"><a href="#⭐数据聚合功能" class="headerlink" title="⭐数据聚合功能"></a>⭐数据聚合功能</h3><ol>
<li><p>从多种数据库查询数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//... 从mysql中获取数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySQLProvider</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">find</span><span class="params">(String str1)</span> &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//.. 从Oracle中获取数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OracleProvider</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">find</span><span class="params">(String str1, String str2)</span> &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//... 从Redis中获取数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisProvider</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义适配器接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IDataProvider</span> &#123;</span><br><span class="line">	List&lt;String&gt; <span class="title function_">find</span><span class="params">(String param)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>根据不同的数据渠道定义不同的适配器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySQLProviderAdapter</span> <span class="keyword">implements</span> <span class="title class_">IDataProvider</span> &#123;	<span class="comment">// MySQL适配器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">MySQLPrivider</span> <span class="variable">mysqlProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MySQLProvider</span>();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">find</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> mysqlProvider.find(str);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OracleProviderAdapter</span> <span class="keyword">implements</span> <span class="title class_">IDataProvider</span> &#123;	<span class="comment">// Oracle适配器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">OracleProvidedr</span> <span class="variable">oracleProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OracleProvider</span>();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">find</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		Map&lt;String, String&gt; data = oracleProvider.find(str, <span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">		List&lt;String&gt; res = map2List(data);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisProvider</span> <span class="keyword">implements</span> <span class="title class_">IDataProvider</span> &#123;	<span class="comment">// Redis适配器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">RedisProvider</span> <span class="variable">redisProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisProvider</span>();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">find</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> redisProvider.get(str);</span><br><span class="line">		<span class="keyword">return</span> Collections.singletonList(data);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>聚合适配器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataManagement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IDataProvider&gt; providers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addProvider</span><span class="params">(IDataProvider provider)</span> &#123;</span><br><span class="line">        providers.add(provider);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">find</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        List&lt;String&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (IDataProvider provider : providers) &#123;</span><br><span class="line">            List&lt;String&gt; data = provider.find(str);</span><br><span class="line">            result.addAll(data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 使用</span></span><br><span class="line">    <span class="type">DataManagement</span> <span class="variable">dataManagement</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataManagement</span>();</span><br><span class="line">    dataManagement.addProvider(<span class="keyword">new</span> <span class="title class_">MySQLProviderAdapter</span>());	<span class="comment">// 添加MySQL适配器</span></span><br><span class="line">    dataManagement.addProvider(<span class="keyword">new</span> <span class="title class_">OracleProviderAdapter</span>());	<span class="comment">// 添加Oracle适配器</span></span><br><span class="line">    dataManagement.addProvider(<span class="keyword">new</span> <span class="title class_">RedisProviderAdapter</span>());	<span class="comment">// 添加Redis适配器</span></span><br><span class="line">    List&lt;String&gt; result = dataManagement.find(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="门面模式（Facade）"><a href="#门面模式（Facade）" class="headerlink" title="门面模式（Facade）"></a>门面模式（Facade）</h2><p>比如用户注册的时候，需要生成一条用户信息，还要给用户分配角色。这样注册这个功能就需要依赖，用户和角色两个服务。</p>
<p>传统的做法就是在用户注册服务中，依赖注入创建用户接口和分配角色接口。如果注册时还有更多的操作，就需要依赖更多的接口。</p>
<p>这种情况就可以定义一个门面服务，让门面服务去依赖用户服务和角色服务。这样注册服务只需要依赖门面服务就可以了。</p>
<p><strong>提高效率</strong>：如果依赖的服务需要通过RPC调用，也可以通过门面模式把多次RPC调用减少为1次。</p>
<p><strong>实现事物</strong>：有些时候需要调用两个更新数据的方法，这两个操作需要同时成功或者同时失败，最简单的方式就是：再设计一个包含这两个方法的新方法。这也是门面模式的一种设计思想。</p>
<h3 id="实现用户注册功能"><a href="#实现用户注册功能" class="headerlink" title="实现用户注册功能"></a>实现用户注册功能</h3><ol>
<li><p>用户注册门面服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegisterFacade</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> RoleService roleService;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">post</span><span class="params">(User user)</span> &#123;</span><br><span class="line">		userService.create(user);		<span class="comment">// 创建用户</span></span><br><span class="line">		roleService.setRole(user);	<span class="comment">// 分配角色</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>用户注册服务接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemService</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> UserRegisterFacade registerFacade;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">		<span class="comment">// 调用门面服务中的操作</span></span><br><span class="line">		registerFacade.post(user);</span><br><span class="line">        <span class="comment">// 执行注册后续的操作...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐组合模式（Compose）"><a href="#⭐组合模式（Compose）" class="headerlink" title="⭐组合模式（Compose）"></a>⭐组合模式（Compose）</h2><p>组合模式可以很方便的把不同类型的对象组合成树形结构。</p>
<h3 id="⭐实现结构树"><a href="#⭐实现结构树" class="headerlink" title="⭐实现结构树"></a>⭐实现结构树</h3><ol>
<li><p>定义组织结构抽象类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Organization</span> &#123;	<span class="comment">// 用来做一些额外的处理逻辑</span></span><br><span class="line">	<span class="keyword">protected</span> BigDecimal salary;	<span class="comment">// 工资</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> age;	<span class="comment">// 年龄</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> BigDecimal <span class="title function_">calculateSalary</span><span class="params">()</span>;	<span class="comment">// 计算部门所有工资总和（包括下级部门）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">calculateAverageAge</span><span class="params">()</span>;	<span class="comment">// 计算部门平均年龄</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">isDeparment</span><span class="params">()</span>;	<span class="comment">// 是否是部门， 部门：true，员工：false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>部门类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Deparment</span> <span class="keyword">implements</span> <span class="title class_">Organization</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Organization&gt; subOrganizations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrganization</span><span class="params">(Organization org)</span> &#123;</span><br><span class="line">		subOrganizations.add(org);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line"> 	  <span class="meta">@Override</span></span><br><span class="line">  	<span class="keyword">public</span> BigDecimal <span class="title function_">calculateSalary</span><span class="params">()</span> &#123;	</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">totalSalary</span> <span class="operator">=</span> BigDecimal.ZERO;</span><br><span class="line">        <span class="keyword">for</span> (Organization org : subOrganizations) &#123;</span><br><span class="line">          totalSalary.add(org.getSalary());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalSalary;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculateAverageAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalAge</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">employeeCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Organization org : subOrganizations) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isDeparment()) &#123;</span><br><span class="line">                totalAge += org.getAge();</span><br><span class="line">                employeeCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalAge / employeeCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDeparment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">public</span> BigDecimal <span class="title function_">getSalary</span><span class="params">()</span> &#123;</span><br><span class="line">    	<span class="type">BigDecimal</span> <span class="variable">totalSalary</span> <span class="operator">=</span> BigDecimal.ZERO;</span><br><span class="line">        <span class="keyword">for</span> (Organization org : subOrganizations) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!org.isDepartment()) &#123;</span><br><span class="line">            totalSalary.add(org.getSalary());</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalSalary;</span><br><span class="line"> 	 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>员工类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Organization</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">calculateSalary</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.salary();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculateAverageAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDeparment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">DeparmentRepository</span> <span class="variable">deparmentRepo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeparmentRepository</span>();	</span><br><span class="line">	<span class="keyword">private</span> <span class="type">EmployeeRepository</span> <span class="variable">employeeRepo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmployeeRepository</span>();	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">ORGANIZATION_ROOT_ID</span> <span class="operator">=</span> <span class="number">1</span>;	<span class="comment">// 顶级部门ID</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildOrganization</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">Deparment</span> <span class="variable">deparment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Deparment</span>();</span><br><span class="line">		deparment.setId(ORGANIZATION_ROOT_ID);</span><br><span class="line">		buildOrganization(deparment);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildOrganization</span><span class="params">(Deparment deparment)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据部门ID获取某个部门的下级部门</span></span><br><span class="line">    List&lt;Deparemnt&gt; subDeparments = deparmentRepo.getDeparmentByParentId(deparment.getId());	</span><br><span class="line">    </span><br><span class="line">		<span class="keyword">for</span> (Deparment subDeparment : subDeparments) &#123;</span><br><span class="line">			deparment.addOrganization(subDeparment);</span><br><span class="line">			buildOrganization(subDeparment);</span><br><span class="line">		&#125;</span><br><span class="line">    </span><br><span class="line">   	    <span class="comment">// 根据部门ID获取员工列表</span></span><br><span class="line">		List&lt;Employee&gt; employees = employeeRepo.getEmployeeByDeparmentId(deparment.getId());	</span><br><span class="line">		<span class="keyword">for</span> (Employee employee : employees) &#123;</span><br><span class="line">			deparment.addOrganization(employee);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐享元模式（Flyweight）"><a href="#⭐享元模式（Flyweight）" class="headerlink" title="⭐享元模式（Flyweight）"></a>⭐享元模式（Flyweight）</h2><p><strong>享元模式可以复用对象，节省内存，不过前提是享元对象是不可变的对象</strong>。</p>
<p>如果系统中有很多重复的对象，并且这些对象都是不可变的，就可以利用享元模式，让这些对象在内存中只保留一份，提供多处引用，这样可以减少内存中对象的数量。</p>
<p>也可以把对象之间相同的字段提取出来，设计成享元类，让这些对象引用享元对象。</p>
<p>不可变对象是指，对象通过构造函数初始化完成之后，就不能再做修改了，所以不能暴露任何set()方法，因为享元对象会被多处引用，如果某一个地方修改了享元对象，就会影响到其它代码。</p>
<p><strong>比较常见的做法就是通过工厂模式，在工厂类中，用一个Map来缓存已经创建过的享元对象，来达到复用的目的</strong>。</p>
<p>比如Integer类中的IntegerCache、Long类中的LongCache也都是利用享元模式来预先存储一些常用的数字(-128~127)</p>
<p><strong>缺点</strong>：享元模式会导致享元类无法被GC回收掉，因为享元工厂类会一直保存着享元对象的引用，这就会导致享元对象在没有任何代码使用的情况下，也不会被JVM回收掉。</p>
<h3 id="⭐实现棋盘游戏"><a href="#⭐实现棋盘游戏" class="headerlink" title="⭐实现棋盘游戏"></a>⭐实现棋盘游戏</h3><ol>
<li><p>定义享元类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内部定义了一些通用的属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChessPieceUnit</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    <span class="keyword">private</span> Color color;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChessPieceUnit</span><span class="params">(<span class="type">int</span> id, String text, Color color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.text = text;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">        RED, BLACK</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>享元工厂类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChessPieceUnitFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, ChessPieceUnit&gt; pieces = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        pieces.put(<span class="number">1</span>, <span class="keyword">new</span> <span class="title class_">ChessPieceUnit</span>(<span class="number">1</span>, <span class="string">&quot;车&quot;</span>, ChessPieceUnit.Color.BLACK));</span><br><span class="line">        pieces.put(<span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">ChessPieceUnit</span>(<span class="number">2</span>, <span class="string">&quot;马&quot;</span>, ChessPieceUnit.Color.BLACK));</span><br><span class="line">        pieces.put(<span class="number">3</span>, <span class="keyword">new</span> <span class="title class_">ChessPieceUnit</span>(<span class="number">3</span>, <span class="string">&quot;象&quot;</span>, ChessPieceUnit.Color.BLACK));</span><br><span class="line">        pieces.put(<span class="number">4</span>, <span class="keyword">new</span> <span class="title class_">ChessPieceUnit</span>(<span class="number">4</span>, <span class="string">&quot;士&quot;</span>, ChessPieceUnit.Color.BLACK));</span><br><span class="line">        pieces.put(<span class="number">5</span>, <span class="keyword">new</span> <span class="title class_">ChessPieceUnit</span>(<span class="number">5</span>, <span class="string">&quot;将&quot;</span>, ChessPieceUnit.Color.BLACK));</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ChessPieceUnit <span class="title function_">getChessPiece</span><span class="params">(<span class="type">int</span> chessPieceId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pieces.get(chessPieceId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>棋子类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChessPiece</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> ChessPieceUnit chessPieceUnit; <span class="comment">// 引用的享元类</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> positionX;	<span class="comment">// 棋子在棋盘上的x坐标</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> positionY;	<span class="comment">// 棋子在棋盘上的y坐标</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChessPiece</span><span class="params">(ChessPieceUnit chessPieceUnit, <span class="type">int</span> positionX, <span class="type">int</span> positionY)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chessPieceUnit = chessPieceUnit;</span><br><span class="line">        <span class="built_in">this</span>.positionX = positionX;</span><br><span class="line">        <span class="built_in">this</span>.positionY = positionY;</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">// getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>棋盘类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChessBoard</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, ChessPiece&gt; chessPieces = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChessBoard</span><span class="params">()</span> &#123;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">      chessPieces.put(<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">ChessPiece</span>(ChessPieceUnitFactory.getChessPiece(<span class="number">1</span>), <span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">      chessPieces.put(<span class="number">2</span>,<span class="keyword">new</span> <span class="title class_">ChessPiece</span>(ChessPieceUnitFactory.getChessPiece(<span class="number">2</span>), <span class="number">0</span>,<span class="number">1</span>));</span><br><span class="line">      chessPieces.put(<span class="number">3</span>,<span class="keyword">new</span> <span class="title class_">ChessPiece</span>(ChessPieceUnitFactory.getChessPiece(<span class="number">3</span>), <span class="number">0</span>,<span class="number">2</span>));</span><br><span class="line">      chessPieces.put(<span class="number">4</span>,<span class="keyword">new</span> <span class="title class_">ChessPiece</span>(ChessPieceUnitFactory.getChessPiece(<span class="number">4</span>), <span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">      chessPieces.put(<span class="number">5</span>,<span class="keyword">new</span> <span class="title class_">ChessPiece</span>(ChessPieceUnitFactory.getChessPiece(<span class="number">5</span>), <span class="number">0</span>,<span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> chessPieceId, <span class="type">int</span> toPositionX, <span class="type">int</span> toPositionY)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐观察者模式（Observer）"><a href="#⭐观察者模式（Observer）" class="headerlink" title="⭐观察者模式（Observer）"></a>⭐观察者模式（Observer）</h2><p><strong>就是在对象之间维护一个中间层，当一个对象状态改变的时候，其它所有依赖的对象都会自动收到通知</strong>。</p>
<p>guava包中的事件总线就是观察者模式（EventBus）</p>
<h3 id="⭐实现注册功能"><a href="#⭐实现注册功能" class="headerlink" title="⭐实现注册功能"></a>⭐实现注册功能</h3><ol>
<li><p>定义观察者接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RegObserver</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">handleRegSuccess</span><span class="params">(<span class="type">long</span> userId)</span>;	<span class="comment">// 用户注册成功时的事件通知函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义观察者实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为新用户生成密码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegPromotionObserver</span> <span class="keyword">implements</span> <span class="title class_">RegObserver</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> PromotionService promitionService;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRegSuccess</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">		promotionService.generatePassword(userId);	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送欢迎邮件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegNotificationObserver</span> <span class="keyword">implements</span> <span class="title class_">RegObserver</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRegSuccess</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">		notificationService.sendMessage(userId, <span class="string">&quot;Welcome...&quot;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>用户注册接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">// 观察者</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;RegObserver&gt; regObservers;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRegObservers</span><span class="params">(List&lt;RegObserver&gt; observers)</span> &#123;</span><br><span class="line">		regObservers = observers;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">		<span class="comment">// 用户注册</span></span><br><span class="line">		<span class="type">long</span> <span class="variable">userId</span> <span class="operator">=</span> userService.register(telephone, password);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 用户注册完成后，通知其它服务</span></span><br><span class="line">		<span class="keyword">for</span> (RegObserver observer : regObservers) &#123;</span><br><span class="line">			observer.handleRegSuccess(userId);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	List&lt;RegObserver&gt; regObservers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    regObservers.add(<span class="keyword">new</span> <span class="title class_">RegNotificationObserver</span>());</span><br><span class="line">    regObservers.add(<span class="keyword">new</span> <span class="title class_">RegPromotionObserver</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="type">UserController</span> <span class="variable">userController</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserController</span>();</span><br><span class="line">    userController.setRegObservers(regObservers);</span><br><span class="line">    userController.register(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>用户注册完之后，要依次调用所有观察者的事件通知方法，都执行完，才会返回结果给客户端，这会影响到注册接口的响应时间。</p>
<p>可以改成异步非阻塞的方式，调用观察者的通知方法，比如在线程池中执行事件通知方法。</p>
<p>也可以用Event Bus（事件总线）框架，或者RocketMQ之类的消息队列。</p>
<h3 id="⭐事件总线"><a href="#⭐事件总线" class="headerlink" title="⭐事件总线"></a>⭐事件总线</h3><ol>
<li><p>定义标记注解，用来标明观察者中，哪个函数可以接收消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Subscribe &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>用来表示@Subscribe 标注的方法。target表示观察者类，method表示方法。主要用在ObserverRegistry观察者注册表中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverAction</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Object target;</span><br><span class="line">	<span class="keyword">private</span> Method method;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ObserverAction</span><span class="params">(Object target, Method method)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.target = Precondition.checkNotNull(target);</span><br><span class="line">		<span class="built_in">this</span>.method = method;</span><br><span class="line">		<span class="built_in">this</span>.method.setAccessable(<span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// event是method方法的参数</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Object event)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			method.invoke(target, event);</span><br><span class="line">		&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>注册表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverRegistry</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> ConcurrentMap&lt;Class&lt;?&gt;, CopyOnWriteArraySet&lt;ObserverAction&gt;&gt; registry = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Object observer)</span> &#123;</span><br><span class="line">		Map&lt;Class&lt;?&gt;, Collection&lt;ObserverAction&gt; observerActions = findAllObserverActions(observer);</span><br><span class="line">		<span class="keyword">for</span> (Map.Entry&lt;Class&lt;?&gt;, Collection&lt;ObserverAction&gt;&gt; entry : observerActions.entrySet()) &#123;</span><br><span class="line">			Class&lt;?&gt; eventType = entry.getKey();</span><br><span class="line">			Collection&lt;ObserverAction&gt; eventActions = entry.getValue();</span><br><span class="line">			CopyOnWriteArraySet&lt;ObserverAction&gt; registeredEventActions = registry.get(eventType);</span><br><span class="line">			<span class="keyword">if</span> (registeredEventActions == <span class="literal">null</span>) &#123;</span><br><span class="line">				registry.putIfAbsent(eventType, <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;());</span><br><span class="line">				registeredEventActions = registry.get(eventType);</span><br><span class="line">			&#125;</span><br><span class="line">			registeredEventActions.addAll(eventActions);</span><br><span class="line">            registry.put(eventType, registeredEventActions);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 找到符合条件的处理器</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;ObserverAction&gt; <span class="title function_">getMatchedObserverActions</span><span class="params">(Object event)</span> &#123;</span><br><span class="line">		List&lt;ObserverAction&gt; matchedObservers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		Class&lt;?&gt; postedEventType = event.getClass();</span><br><span class="line">		<span class="keyword">for</span> (Map.Entry&lt;Class&lt;?&gt;, CopyOnWriteArraySet&lt;ObserverAction&gt;&gt; entry : registry) &#123;</span><br><span class="line">			Class&lt;?&gt; eventType = entry.getKey();</span><br><span class="line">			CopyOnWriteArraySet&lt;ObserverAction&gt; eventActions = entry.getValue();</span><br><span class="line">			<span class="comment">// 判断是否是父类</span></span><br><span class="line">			<span class="keyword">if</span> (postedEventType.isAssignableFrom(eventType)) &#123;</span><br><span class="line">				matchedObservers.addAll(eventActions);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> matchedObservers;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Map&lt;Class&lt;?&gt;, Collection&lt;ObserverAction&gt;&gt; findAllObserverActions(Object observer) &#123;</span><br><span class="line">		Map&lt;Class&lt;?&gt;, Collection&lt;ObserverAction&gt;&gt; observerActions = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Class&lt;?&gt; clazz = observer.getClass();</span><br><span class="line">        <span class="keyword">for</span> (Method method : clazz.getDeclaredMethods() &#123;</span><br><span class="line">	        <span class="keyword">if</span> (method.isAnnotationPresent(Subscribe.class)) &#123;</span><br><span class="line">	        	Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">	        	<span class="keyword">if</span> (parameterTypes.length != <span class="number">1</span>) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ArgumentException</span>(<span class="string">&quot;参数长度错误&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				Class&lt;?&gt; eventType = parameterTypes[<span class="number">0</span>];</span><br><span class="line">				<span class="keyword">if</span> (!observerActions.containsKey(eventType)) &#123;</span><br><span class="line">					observerActions.put(eventType, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">				&#125;</span><br><span class="line">				observerActions.get(eventType).add(<span class="keyword">new</span> <span class="title class_">ObserverAction</span>(observer, method));</span><br><span class="line">	        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> observerActions;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>事件总线</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步事件总线</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventBus</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Executor executor;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">ObserverRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObserverRegistry</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">EventBus</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// MoreExecutors.directExecutor()是Google Guava提供的工具类，实际上是一个单线程的线程池，主要还是为了跟AsyncEventBus统一代码逻辑，做到代码复用。</span></span><br><span class="line">		<span class="built_in">this</span>(MoreExecutors.directExecutor());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="title function_">EventBus</span><span class="params">(Executor executor)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.executor = executor;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">		registry.register(object);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">post</span><span class="params">(Object event)</span> &#123;</span><br><span class="line">		List&lt;ObserverAction&gt; observerActions = registry.getMatchedObserverActions(event);</span><br><span class="line">		<span class="keyword">for</span> (ObserverAction observerAction : observerActions) &#123;</span><br><span class="line">			executor.execute(<span class="keyword">new</span> <span class="title class_">Runable</span>() &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">					observerAction.execute(event);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步事件总线</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncEventBus</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AsyncEventBus</span><span class="params">(Executor executor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(executor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">EventBus</span> <span class="variable">eventBus</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventBus</span>();</span><br><span class="line">	eventBus.register(<span class="keyword">new</span> <span class="title class_">RegNotificationObserver</span>());</span><br><span class="line">	eventBus.post(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐模板模式（Template-Method）"><a href="#⭐模板模式（Template-Method）" class="headerlink" title="⭐模板模式（Template Method）"></a>⭐模板模式（Template Method）</h2><p><strong>就是定义一个模板方法，规定业务流程，让子类来实现流程的业务逻辑</strong>。</p>
<p><strong>在Java中，通常是把模板方法定义成final的，避免被子类重写，需要子类重写的方法，定义为abstract的，强迫子类实现</strong>。</p>
<p>可以提高代码的复用性和拓展性。</p>
<p>JDK中有很多类都用到了模板模式，比如InputStream、OutputStream、Reader、Writer。</p>
<p>InputStream中read()方法就是一个模板方法，规定了读取数据的流程，而且还暴露了一个重载的抽象方法，让子类来实现读取数据的逻辑。</p>
<p>AbstractList中addAll()也是一个模板方法，需要依赖子类重写add()方法才能调用。</p>
<h3 id="⭐模板模式结构"><a href="#⭐模板模式结构" class="headerlink" title="⭐模板模式结构"></a>⭐模板模式结构</h3><ol>
<li><p>定义模板类和模板方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractTemplate</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">templateMethod</span><span class="params">()</span> &#123;	<span class="comment">// 定义模板方法，规定业务流程</span></span><br><span class="line">		f1();</span><br><span class="line">		f2();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span>;	<span class="comment">// 流程1</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span>;	<span class="comment">// 流程2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义子类实现流程1和流程2的逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Concrete1</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplate</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span> </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Concrete2</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplate</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span> </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">AbstractTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Concreate1</span>();</span><br><span class="line">	template.templateMethod();</span><br><span class="line">    </span><br><span class="line">    template = <span class="keyword">new</span> <span class="title class_">Concreate2</span>();</span><br><span class="line">    template.templateMethod();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐策略模式（Strategy）"><a href="#⭐策略模式（Strategy）" class="headerlink" title="⭐策略模式（Strategy）"></a>⭐策略模式（Strategy）</h2><p>就是定义一个策略接口，然后再根据不同的逻辑定义一些实现这个接口的策略类。这样就可以很灵活的替换不同的策略。</p>
<p>策略模式一般都会通过类型，来判断创建哪个策略来使用，可以可以配合工厂模式，把创建策略的逻辑放到工厂类中。</p>
<p>如果策略类是无状态的，不包含成员变量，这样的策略对象是可以共享的，不需要每次都创建新的对象，可以预先创建好策略对象，缓存到工厂类中。</p>
<h3 id="⭐策略模式结构"><a href="#⭐策略模式结构" class="headerlink" title="⭐策略模式结构"></a>⭐策略模式结构</h3><ol>
<li><p>定义策略接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Strategy &#123;</span><br><span class="line">	void method();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义策略实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略类1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteStrategyA</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 具体的逻辑...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略类2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteStrategyB</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 具体的逻辑...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义策略工厂类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义策略工厂类，用来创建具体的策略</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrategyFactory</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Strategy&gt; strategies = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();	<span class="comment">// 用来缓存策略对象</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		strategies.put(<span class="string">&quot;A&quot;</span>, <span class="keyword">new</span> <span class="title class_">ConcreteStrategyA</span>());</span><br><span class="line">		strategies.put(<span class="string">&quot;B&quot;</span>, <span class="keyword">new</span> <span class="title class_">ConcreteStrategyB</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Strategy <span class="title function_">getStrategy</span><span class="params">(String type)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> strategies.get(type);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">Strategy</span> <span class="variable">strategy</span> <span class="operator">=</span> StrategyFactory.getStrategy(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    strategy.method();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐责任链模式（Chain-Of-Responsibility）"><a href="#⭐责任链模式（Chain-Of-Responsibility）" class="headerlink" title="⭐责任链模式（Chain Of Responsibility）"></a>⭐责任链模式（Chain Of Responsibility）</h2><p>就是多个类处理同一个请求，一个请求先经过A处理，然后再把请求传递给B处理，B再传递给C处理。每个类都承担着自己的职责。</p>
<p>Servlet中的Filter和Spring中的Interceptor都使用了责任链模式。</p>
<h3 id="⭐实现过滤敏感信息功能"><a href="#⭐实现过滤敏感信息功能" class="headerlink" title="⭐实现过滤敏感信息功能"></a>⭐实现过滤敏感信息功能</h3><ol>
<li><p>定义敏感信息过滤接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SensitiveFilter</span> &#123;</span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">doFilter</span><span class="params">(Content content)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>根据数据类型定义不同的过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文本过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveTextFilter</span> <span class="keyword">implements</span> <span class="title class_">SensitiveFilter</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doFilter</span><span class="params">(Content content)</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">legal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// 判断用户输入的文本是否包含敏感词汇</span></span><br><span class="line">		<span class="keyword">return</span> legal;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图片过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveImageFilter</span> <span class="keyword">implements</span> <span class="title class_">SensitiveFilter</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doFilter</span><span class="params">(Content content)</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">legal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// 判断用户上传的图片是否包含敏感信息</span></span><br><span class="line">		<span class="keyword">return</span> legal;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 视频过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveVideoFilter</span> <span class="keyword">implements</span> <span class="title class_">SensitiveFilter</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doFilter</span><span class="params">(Content content)</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">legal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// 判断用户上传的视频是否包含敏感信息</span></span><br><span class="line">		<span class="keyword">return</span> legal;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 音频过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveAudioFilter</span> <span class="keyword">implements</span> <span class="title class_">SensitiveFilter</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doFilter</span><span class="params">(Content content)</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">legal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// 判断用户上传的音频是否包含敏感信息</span></span><br><span class="line">		<span class="keyword">return</span> legal;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义责任链类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveFilterChain</span> &#123;</span><br><span class="line">    <span class="comment">// 过滤器</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SensitiveFilter&gt; filters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFilter</span><span class="params">(SensitiveFilter filter)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.filters.add(filter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">filter</span><span class="params">(Content content)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (SensitiveFilter filter : filters) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!filter.doFilter(content)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(Stirng[] args)</span> &#123;</span><br><span class="line">    <span class="type">SensitiveFilterChain</span> <span class="variable">filterChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SensitiveFilterChain</span>();</span><br><span class="line">    filterChain.addFilter(<span class="keyword">new</span> <span class="title class_">SensitiveTextFilter</span>());</span><br><span class="line">    filterChain.addFilter(<span class="keyword">new</span> <span class="title class_">SensitiveImageFilter</span>());</span><br><span class="line">    filterChain.addFilter(<span class="keyword">new</span> <span class="title class_">SensitiveVideoFilter</span>());</span><br><span class="line">    filterChain.addFilter(<span class="keyword">new</span> <span class="title class_">SensitiveAudioFilter</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">legal</span> <span class="operator">=</span> filterChain.filter(<span class="keyword">new</span> <span class="title class_">Content</span>());</span><br><span class="line">    <span class="keyword">if</span> (legal) &#123;</span><br><span class="line">        <span class="comment">// 合法</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 不合法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐状态模式（Finite-State-Machine）"><a href="#⭐状态模式（Finite-State-Machine）" class="headerlink" title="⭐状态模式（Finite State Machine）"></a>⭐状态模式（Finite State Machine）</h2><p>状态模式就是把，事件触发的状态转移和执行动作，拆分到不同的类中。</p>
<h3 id="⭐超级马里奥游戏"><a href="#⭐超级马里奥游戏" class="headerlink" title="⭐超级马里奥游戏"></a>⭐超级马里奥游戏</h3><ol>
<li><p>定义马里奥接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMario</span> &#123;</span><br><span class="line">	<span class="comment">// 定义事件</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">obtainMushroom</span><span class="params">()</span>; <span class="comment">// 获得蘑菇事件</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">obtainCape</span><span class="params">()</span>;	<span class="comment">// 获得斗篷事件</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">obtainFireFlower</span><span class="params">()</span>;	<span class="comment">// 获得火焰花事件</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">meetMonster</span><span class="params">()</span>; <span class="comment">// 遇到怪物事件</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">topBrick</span><span class="params">()</span>;	<span class="comment">// 顶砖头事件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>马里奥实现类，并根据马里奥状态重写事件逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 小马里奥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmallMario</span> <span class="keyword">implements</span> <span class="title class_">IMario</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MarioStateMachine marioStateMachine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SmallMario</span><span class="params">(MarioStateMachine marioStateMachine)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.marioStateMachine = marioStateMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">obtainMushroom</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//小马里奥获得蘑菇，变为超级马里奥</span></span><br><span class="line">        marioStateMachine.setState(<span class="keyword">new</span> <span class="title class_">SuperMario</span>(marioStateMachine));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">obtainCape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 小马里奥获得斗篷，变成斗篷马里奥</span></span><br><span class="line">        marioStateMachine.setState(<span class="keyword">new</span> <span class="title class_">CapeMario</span>(marioStateMachine));</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">obtainFireFlower</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 小马里奥获得火焰花，变成火焰马里奥</span></span><br><span class="line">        marioStateMachine.setState(<span class="keyword">new</span> <span class="title class_">FireMario</span>(marioStateMachine));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">meetMonster</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 小马里奥遇到怪物，减少一条命</span></span><br><span class="line">   		marioStateMachine.descreaseLife();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">topBrick</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 小马里奥顶砖头，不会破坏砖头</span></span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 超级马里奥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMario</span> <span class="keyword">implements</span> <span class="title class_">IMario</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MarioStateMachine marioStateMachine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SuperMario</span><span class="params">(MarioStateMachine marioStateMachine)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.marioStateMachine = marioStateMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">obtainMushroom</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 超级马里奥获得蘑菇，积分加100</span></span><br><span class="line">        marioStateMachine.increaseScore(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">obtainCape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 超级马里奥获得斗篷，变成斗篷马里奥</span></span><br><span class="line">        marioStateMachine.setState(<span class="keyword">new</span> <span class="title class_">CapeMario</span>(marioStateMachine));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">obtainFireFlower</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 超级马里奥获得火焰花，变成火焰马里奥</span></span><br><span class="line">        marioStateMachine.setState(<span class="keyword">new</span> <span class="title class_">FireMario</span>(marioStateMachine));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">meetMonster</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 超级马里奥遇到怪物，变成小马里奥</span></span><br><span class="line">        marioStateMachine.setState(<span class="keyword">new</span> <span class="title class_">SmallMario</span>(marioStateMachine));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">topBrick</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 超级马里奥顶砖头，会破坏砖头</span></span><br><span class="line">        marioStateMachine.distoryBrick();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义状态机</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MarioStateMachine</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IMario currentMario;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MarioStateMachine</span><span class="params">()</span> &#123;</span><br><span class="line">		currentMario = <span class="keyword">new</span> <span class="title class_">SmallMario</span>(<span class="built_in">this</span>);	<span class="comment">//默认是小马里奥</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(IMario mario)</span> &#123;</span><br><span class="line">        currentMario = mario;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> IMario <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.currentMario;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MarioStateMachine</span> <span class="variable">marioStateMachine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MarioStateMachine</span>();</span><br><span class="line">    marioStateMachine.obtainMushroom(); <span class="comment">// 吃蘑菇</span></span><br><span class="line">    marioStateMachine.topBrick();	<span class="comment">// 顶砖头</span></span><br><span class="line">    marioStateMachine.getState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="迭代器模式（Iterator）"><a href="#迭代器模式（Iterator）" class="headerlink" title="迭代器模式（Iterator）"></a>迭代器模式（Iterator）</h2><p>迭代器模式就是用来遍历集合的，它会把集合的遍历操作从集合类中拆分出来，放到迭代器类中，让双方的职责更单一。</p>
<p>foreach循环是一个语法糖，底层是基于迭代器来实现的。</p>
<p>for循环比较适合遍历数组、链表这种线性数据结构。对于复杂的数据结构，比如树、图，树有前中后序、按层遍历，图有深度优先、广度优先遍历。使用迭代器模式就可以针对深度优先和广度优先，定义两个迭代器，分别实现深度优先和广度优先。    </p>
<h3 id="基于快照的迭代器"><a href="#基于快照的迭代器" class="headerlink" title="基于快照的迭代器"></a>基于快照的迭代器</h3><p>为每个元素保存两个时间戳，一个是添加时间addTimestamp，另一个是删除时间delTimestamp。</p>
<p>当元素被加入到集合的时候，addTimestamp = 当前时间、delTimestamp = Long.MAX_VALUE。</p>
<p>当元素被删除的时候，delTimestamp = 当前时间。表示已经被删除。</p>
<p>再定义一个快照的创建时间 snapshotTimestamp。只有addTimestamp &lt; snapshotTimestamp &lt; delTimestamp 的元素才属于当前快照。</p>
<p>如果元素的添加时间大于快照的创建时间，说明元素是在快照之后才加入的，不属于当前快照。</p>
<p>如果元素的删除时间小于快照的创建时间，说明元素在快照之前就被删除掉了，也不属于当前快照。</p>
<ol>
<li><p>定义ArrayList</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt; &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> actualSize;	<span class="comment">// 不包含标记删除的元素。</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> totalSize;	<span class="comment">// 包含标记删除的元素</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Object[] elements;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span>[] addTimestamps;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span>[] delTimestamps;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.elements = <span class="keyword">new</span> <span class="title class_">Object</span>[DEFAULT_CAPACITY];</span><br><span class="line">		<span class="built_in">this</span>.addTimestamps = <span class="keyword">new</span> <span class="title class_">long</span>[DEFAULT_CAPACITY];</span><br><span class="line">		<span class="built_in">this</span>.delTimestamps = <span class="keyword">new</span> <span class="title class_">long</span>[DEFAULT_CAPACITY];</span><br><span class="line">		<span class="built_in">this</span>.actualSize = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">this</span>.totalSize = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Iterator <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SnapshotArrayIterator</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E obj)</span> &#123;</span><br><span class="line">		elements[totalSize] = obj;</span><br><span class="line">		addTimestamps[totalSize] = System.currentTimeMills();</span><br><span class="line">		delTimestamps[totalSize] = Long.MAX_VALUE;</span><br><span class="line">		totalSize++;</span><br><span class="line">		actualSize++;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(E obj)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; totalSize; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (elements[i].equals(obj)) &#123;</span><br><span class="line">				delTimestamps[i] = System.currentTimeMills();</span><br><span class="line">				actualSize--;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (i &gt;= totalSize) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (E) elements[i];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义迭代器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnapshotArrayIterator</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;E&gt; &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> snapshotTimestamp;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> cursorInAll;	<span class="comment">// 在整个容器中的下标，而非快照中的下标</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> leftCount;	<span class="comment">// 快照中还有几个元素未被遍历</span></span><br><span class="line">	<span class="keyword">private</span> ArrayList&lt;E&gt; arrayList;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">SnapshotArrayIterator</span><span class="params">(ArrayList&lt;E&gt; arrayList)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.snapshotTimestamp = System.currentTimeMills();</span><br><span class="line">		<span class="built_in">this</span>.cursorInAll = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">this</span>.leftCount = arrayList.actualSize();</span><br><span class="line">		<span class="built_in">this</span>.arrayList = arrayList;</span><br><span class="line">		</span><br><span class="line">		justNext();	<span class="comment">//先跳到这个迭代器快照的第一个元素</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.leftCount &gt;= <span class="number">0</span>;	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">E</span> <span class="variable">currentItem</span> <span class="operator">=</span> arrayList.get(cursorInAll);</span><br><span class="line">		justNext();</span><br><span class="line">		<span class="keyword">return</span> currentItem;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">justNext</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">while</span>(cursorInAll &lt; arrayList.totalSize()) &#123;</span><br><span class="line">			<span class="type">long</span> <span class="variable">addTimestamp</span> <span class="operator">=</span> arrayList.getAddTimestmap(cursorInAll);</span><br><span class="line">			<span class="type">long</span> <span class="variable">delTimestamp</span> <span class="operator">=</span> arrayList.getDelTimestamp(cursorInALl);</span><br><span class="line">			<span class="keyword">if</span> (snapshotTimestamp &gt; addTimestamp &amp;&amp; snapshotTimestamp &lt; delTimestamp) &#123;</span><br><span class="line">				leftCount--;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			cursorInAll++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="访问者模式（Visitor-Pattern）"><a href="#访问者模式（Visitor-Pattern）" class="headerlink" title="访问者模式（Visitor Pattern）"></a>访问者模式（Visitor Pattern）</h2><p>访问者模式针对的是一组不同类型的对象，但是这组对象需要继承相同的父类。为了避免不断添加新功能导致类不断膨胀，可以使用访问者模式将对象与业务逻辑解耦，可以把这些业务逻辑抽离出来，定义在访问者类中。</p>
<h3 id="实现文件解析和压缩功能"><a href="#实现文件解析和压缩功能" class="headerlink" title="实现文件解析和压缩功能"></a>实现文件解析和压缩功能</h3><ol>
<li><p>定义文件父类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ResourceFile</span> &#123;</span><br><span class="line">	<span class="keyword">protected</span> String filePath;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ResourceFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.filePath = filePath;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>根据文件类型定义不同的文件实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PDF文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PdfFile</span> <span class="keyword">extends</span> <span class="title class_">ResourceFile</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">PdfFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>(filePath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">		visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PPT文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PPTFile</span> <span class="keyword">extends</span> <span class="title class_">ResourceFile</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">PPTFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>(filePath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">		visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义访问者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(PdfFile pdfFile)</span>;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(PPTFile pptFile)</span>;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(WordFile wordFile)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义访问者实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取文件内容访问者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Extractor</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(PdfFile pdfFile)</span> &#123;</span><br><span class="line">		<span class="comment">// 将pdf提取到txt文本</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(PPTFile pptFile)</span> &#123;</span><br><span class="line">		<span class="comment">// 将ppt提取到txt文本</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(WordFile wordFile)</span> &#123;</span><br><span class="line">		<span class="comment">// 将word提取到txt文本</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 压缩文件访问者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Compressor</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(PdfFile pdfFile)</span> &#123;</span><br><span class="line">		<span class="comment">// 压缩pdf文件</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(PPTFile pptFile)</span> &#123;</span><br><span class="line">		<span class="comment">// 压缩ppt文件</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(WordFile wordFile)</span> &#123;</span><br><span class="line">		<span class="comment">// 压缩word文件</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToolApplication</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Extactor</span> <span class="variable">extractor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Extractor</span>();</span><br><span class="line">		List&lt;ResourceFile&gt; resourceFiles = listAllResourceFiles(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/test/&quot;</span>));</span><br><span class="line">		<span class="keyword">for</span> (ResourceFile file : resourceFiles) &#123;</span><br><span class="line">			file.accept(extractor);	<span class="comment">// 提取文件内容</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">Compressor</span> <span class="variable">compressor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Compressor</span>();</span><br><span class="line">		<span class="keyword">for</span> (ResourceFile file : resourceFiles) &#123;</span><br><span class="line">			file.accept(compressor);	<span class="comment">// 压缩文件</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;ResourceFile&gt; <span class="title function_">listAllResourceFiles</span><span class="params">(File resourceDirectory)</span> &#123;</span><br><span class="line">		List&lt;ResourceFile&gt; resourceFiles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		File[] files = resourceDirectory.listFiles();</span><br><span class="line">		<span class="keyword">for</span>(File file : files) &#123;</span><br><span class="line">			<span class="type">ResourceFile</span> <span class="variable">resourceFile</span> <span class="operator">=</span> ResourceFileFactory.createResourceFile(file);</span><br><span class="line">			resourceFiles.add(resourceFile);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> resourceFiles;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="备忘录模式（Memento）"><a href="#备忘录模式（Memento）" class="headerlink" title="备忘录模式（Memento）"></a>备忘录模式（Memento）</h2><p><strong>在不违背封装原则的前提下，获取并保存一个对象的内部状态，以便之后恢复对象为之前的状态</strong>。</p>
<p>备忘录模式主要分为两部分：一部分是存储副本以便后期恢复，另一部分是在不违反封装原则的前提下，进行对象备份和恢复。</p>
<p>比如在很多文本编辑器中，使用Ctrl+Z可以撤销上一次输入的文本，这样的场景就可以使用备忘录模式。</p>
<h3 id="实现文本编辑器"><a href="#实现文本编辑器" class="headerlink" title="实现文本编辑器"></a>实现文本编辑器</h3><ol>
<li><p>定义文本对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用来存储用户输入的所有文本内容</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputText</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">StringBuilder</span> <span class="variable">text</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> text.toString();</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">append</span><span class="params">(String input)</span> &#123;</span><br><span class="line">		text.append(input);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restoreSnapshot</span><span class="params">(Snapshot snapshot)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.text.replace(<span class="number">0</span>, <span class="built_in">this</span>.text.length(), snapshot.getText());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户输入的文本对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Snapshot</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> String text;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Snapshot</span><span class="params">(String text)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.text = text;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> text;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>保存用户输入的文本副本的容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnapshotHolder</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Stack&lt;Snapshot&gt; snapshots = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();	<span class="comment">// 用来存储每次用户输入的文本对象的副本</span></span><br><span class="line">	<span class="keyword">public</span> Snapshot <span class="title function_">popSnapshot</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> snapshots.pop();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushSnapshot</span><span class="params">(Snapshot snapshot)</span> &#123;</span><br><span class="line">		snapshots.push(snapshot);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">InputTtext</span> <span class="variable">inputText</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputText</span>();</span><br><span class="line">	<span class="type">SnapshotHolder</span> <span class="variable">snapshotHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SnapshotHolder</span>();</span><br><span class="line">	<span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">	<span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">		<span class="keyword">if</span> (<span class="string">&quot;ctrl+z&quot;</span>.equals(input)) &#123;</span><br><span class="line">			<span class="type">Snapshot</span> <span class="variable">snapshot</span> <span class="operator">=</span> snapshotHolder.popSnapshot();</span><br><span class="line">			inputText.restoreSnapshot(snapshot);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			inputText.append(input);</span><br><span class="line">			snapshotHolder.pushSnapshot(<span class="keyword">new</span> <span class="title class_">Snapshot</span>(input));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="命令模式（Command）"><a href="#命令模式（Command）" class="headerlink" title="命令模式（Command）"></a>命令模式（Command）</h2><p>命令模式就是，将函数封装成一个对象，这样就可以把函数当成变量一样传递来传递去。</p>
<h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><ol>
<li><p>定义命令接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>命令实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 眩晕敌人</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FaintEnemyCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 攻击敌人</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttackEnemyCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>命令执行器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Queue&lt;Command&gt; commands = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCommand</span><span class="params">(Command command)</span> &#123;</span><br><span class="line">		commands.add(command);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeCommands</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">while</span> (!commands.isEmpty()) &#123;</span><br><span class="line">            <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> commands.poll();</span><br><span class="line">            command.execute();</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> voids <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">Invoker</span> <span class="variable">invoke</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Invoker</span>();</span><br><span class="line">	invoke.addCommand(<span class="keyword">new</span> <span class="title class_">FaintEnemyCommand</span>());	<span class="comment">// 添加眩晕敌人的命令</span></span><br><span class="line">	invoke.addCommand(<span class="keyword">new</span> <span class="title class_">AttackEnemyCommand</span>());	<span class="comment">// 添加攻击敌人的命令</span></span><br><span class="line">	invoke.executeCommands();	<span class="comment">// 执行所有命令</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="⭐解释器模式（Interpreter）"><a href="#⭐解释器模式（Interpreter）" class="headerlink" title="⭐解释器模式（Interpreter）"></a>⭐解释器模式（Interpreter）</h2><p>解释器模式可以用来为某个语言定义它的语法，并定义 一个解释器来处理语法。</p>
<h3 id="⭐实现表达式解析器"><a href="#⭐实现表达式解析器" class="headerlink" title="⭐实现表达式解析器"></a>⭐实现表达式解析器</h3><ol>
<li><p>定义解析器接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>解析器实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 大于解析器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">GreaterExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">GreaterExpression</span><span class="params">(String key, <span class="type">long</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">GreaterExpression</span><span class="params">(String strExpression)</span> &#123;</span><br><span class="line">            String[] elements = strExpression.trim().split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (elements.length &gt; <span class="number">3</span> || !elements[<span class="number">1</span>].trim().equals(<span class="string">&quot;&gt;&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.key = elements[<span class="number">0</span>].trim();</span><br><span class="line">            <span class="built_in">this</span>.value = Long.parseLong(elements[<span class="number">2</span>].trim());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!stats.containsKey(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">long</span> <span class="variable">statValue</span> <span class="operator">=</span> stats.get(key);</span><br><span class="line">            <span class="keyword">return</span> statValue &gt; value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 小于解析器</span></span><br><span class="line"><span class="keyword">public</span>    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LessExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LessExpression</span><span class="params">(String key, <span class="type">long</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LessExpression</span><span class="params">(String strExpression)</span> &#123;</span><br><span class="line">            String[] elements = strExpression.trim().split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (elements.length &lt; <span class="number">3</span> || !elements[<span class="number">1</span>].trim().equals(<span class="string">&quot;&lt;&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.key = elements[<span class="number">0</span>].trim();</span><br><span class="line">            <span class="built_in">this</span>.value = Long.parseLong(elements[<span class="number">2</span>].trim());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!stats.containsKey(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">statValue</span> <span class="operator">=</span> stats.get(key);</span><br><span class="line">            <span class="keyword">return</span> statValue &lt; value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等于解析器</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EqualsExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">EqualsExpression</span><span class="params">(String key, <span class="type">long</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">EqualsExpression</span><span class="params">(String strExpression)</span> &#123;</span><br><span class="line">            String[] elements = strExpression.trim().split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (elements.length &lt; <span class="number">3</span> || !elements[<span class="number">1</span>].trim().equals(<span class="string">&quot;==&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.key = elements[<span class="number">0</span>].trim();</span><br><span class="line">            <span class="built_in">this</span>.value = Long.parseLong(elements[<span class="number">2</span>].trim());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!stats.containsKey(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">statValue</span> <span class="operator">=</span> stats.get(key);</span><br><span class="line">            <span class="keyword">return</span> statValue == value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// and解析器</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AndExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> List&lt;Expression&gt; expressions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">AndExpression</span><span class="params">(List&lt;Expression&gt; expressions)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.expressions = expressions;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">AndExpression</span><span class="params">(String strExpression)</span> &#123;</span><br><span class="line">            String[] elements = strExpression.split(<span class="string">&quot;&amp;&amp;&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String str : elements) &#123;</span><br><span class="line">                <span class="keyword">if</span> (str.contains(<span class="string">&quot;&gt;&quot;</span>)) &#123;</span><br><span class="line">                    expressions.add(<span class="keyword">new</span> <span class="title class_">GreaterExpression</span>(str));</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str.contains(<span class="string">&quot;&lt;&quot;</span>)) &#123;</span><br><span class="line">                    expressions.add(<span class="keyword">new</span> <span class="title class_">LessExpression</span>(str));</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str.contains(<span class="string">&quot;==&quot;</span>)) &#123;</span><br><span class="line">                    expressions.add(<span class="keyword">new</span> <span class="title class_">EqualsExpression</span>(str));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Expression expression : expressions) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!expression.interpret(stats)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// or解析器</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OrExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> List&lt;Expression&gt; expressions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">OrExpression</span><span class="params">(List&lt;Expression&gt; expressions)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.expressions = expressions;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">OrExpression</span><span class="params">(String strExpression)</span> &#123;</span><br><span class="line">          String[] strExpressions = strExpression.split(<span class="string">&quot;\\|\\|&quot;</span>);</span><br><span class="line">          <span class="keyword">for</span> (String expr : strExpressions) &#123;</span><br><span class="line">              expressions.add(<span class="keyword">new</span> <span class="title class_">AndExpression</span>(expr));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span> &#123;</span><br><span class="line">          <span class="keyword">for</span> (Expression expr : expressions) &#123;</span><br><span class="line">              <span class="keyword">if</span> (expr.interpret(stats)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>解析器入口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AlertRuleInterpret</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Expression expression;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">AlertRuleInterpret</span><span class="params">(String ruleExpression)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.expression = <span class="keyword">new</span> <span class="title class_">OrExpression</span>(ruleExpression);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, Long&gt; stats)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> expression.interpret(stats);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rule</span> <span class="operator">=</span> <span class="string">&quot;key1 &gt; 100 || key2 == 50 &amp;&amp; key3 == 30&quot;</span>;</span><br><span class="line">        Map&lt;String, Long&gt; stats = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        stats.put(<span class="string">&quot;key1&quot;</span>, <span class="number">100L</span>);</span><br><span class="line">        stats.put(<span class="string">&quot;key2&quot;</span>, <span class="number">50L</span>);</span><br><span class="line">        stats.put(<span class="string">&quot;key3&quot;</span>, <span class="number">20L</span>);</span><br><span class="line">        stats.put(<span class="string">&quot;key4&quot;</span>, <span class="number">80L</span>);</span><br><span class="line">        <span class="type">AlertRuleInterpret</span> <span class="variable">alertRuleInterpret</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertRuleInterpret</span>(rule);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> alertRuleInterpret.interpret(stats);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="中介模式（Mediator）"><a href="#中介模式（Mediator）" class="headerlink" title="中介模式（Mediator）"></a>中介模式（Mediator）</h2><p><strong>中介模式就是把，一组对象之间的依赖关系，从多对多，转换成一对多。微服务中的注册中心，就可以理解为是一种中介模式</strong>。</p>
<h3 id="实现UI控制器"><a href="#实现UI控制器" class="headerlink" title="实现UI控制器"></a>实现UI控制器</h3><ol>
<li><p>定义中介接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Component component, Event event)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义中介实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LandingPageDialog</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Button loginButton;</span><br><span class="line">    <span class="keyword">private</span> Button registerButton;</span><br><span class="line">    <span class="keyword">private</span> Input usernameInput;</span><br><span class="line">    <span class="keyword">private</span> Input passwordInput;</span><br><span class="line">    <span class="keyword">private</span> Selection selection;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Componment component, Event event)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (component.equals(loginButton)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> usernameInput.text();</span><br><span class="line">            <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> passwordInput.text();</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (component.equals(registerButton)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> usernameInput.text();</span><br><span class="line">            <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> passwordInput.text();</span><br><span class="line">            <span class="comment">// 校验数据</span></span><br><span class="line">            <span class="comment">// 业务处理</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (component.equals(selection)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">selectionItem</span> <span class="operator">=</span> selection.select();</span><br><span class="line">            <span class="keyword">if</span> (selectionItem.equals(<span class="string">&quot;login&quot;</span>)) &#123;</span><br><span class="line">                usernameInput.show();</span><br><span class="line">                passwordInput.show();</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UIControl</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOGIN_BUTTON_ID</span> <span class="operator">=</span> <span class="string">&quot;login_button&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REGISTER_BUTTON_ID</span> <span class="operator">=</span> <span class="string">&quot;register_button&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USERNAME_INPUT_ID</span> <span class="operator">=</span> <span class="string">&quot;username_input&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD_INPUT_ID</span> <span class="operator">=</span> <span class="string">&quot;password_input&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SELECTION_ID</span> <span class="operator">=</span> <span class="string">&quot;selection&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Button</span> <span class="variable">loginButton</span> <span class="operator">=</span> (Button) findComponmentById(LOGIN_BUTTON_ID);</span><br><span class="line">		<span class="type">Button</span> <span class="variable">registerButton</span> <span class="operator">=</span> (Button) findComponmentById(REGISTER_BUTTON_ID);</span><br><span class="line">		<span class="type">Input</span> <span class="variable">usernameInput</span> <span class="operator">=</span> (Input) findComponmentById(USERNAME_INPUT_ID);</span><br><span class="line">		<span class="type">Input</span> <span class="variable">passwordInput</span> <span class="operator">=</span> (Input) findComponmentById(PASSWORD_INPUT_ID);</span><br><span class="line">		<span class="type">Selection</span> <span class="variable">selection</span> <span class="operator">=</span> (Selection) findComponmentById(SELECTION_ID);</span><br><span class="line">		</span><br><span class="line">		<span class="type">Mediator</span> <span class="variable">dialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LandingPageDialog</span>();</span><br><span class="line">        dialog.setLoginButton(loginButton);</span><br><span class="line">        dialog.setRegisterButton(registerButton);</span><br><span class="line">        dialog.setUsernameInput(usernameInput);</span><br><span class="line">        dialog.setPasswordInput(passwordInput);</span><br><span class="line">        dialog.setSelection(selection);</span><br><span class="line">		</span><br><span class="line">        loginButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">()</span> &#123;</span><br><span class="line">                dialog.handleEvent(loginButton, Event.CLICK);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        registerButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">()</span> &#123;</span><br><span class="line">                dialog.handleEvent(registerButton, Event.REGISTER);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Rainy 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Rainy 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"># 设计模式</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/12/08/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" rel="prev" title="设计原则">
      <i class="fa fa-chevron-left"></i> 设计原则
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/12/08/MySQL/" rel="next" title="MySQL">
      MySQL <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="rainy-zhang/rainy-zhang.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  






<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%88Factory%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">⭐工厂模式（Factory）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82"><span class="nav-number">1.1.</span> <span class="nav-text">⭐简单工厂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">⭐工厂方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82"><span class="nav-number">1.3.</span> <span class="nav-text">⭐抽象工厂</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Singleton%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">单例模式（Singleton）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A5%BF%E6%B1%89%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">饿汉式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%87%92%E6%B1%89%E5%BC%8F"><span class="nav-number">2.2.</span> <span class="nav-text">懒汉式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E9%87%8D%E6%A3%80%E6%B5%8B%E6%9C%BA%E5%88%B6"><span class="nav-number">2.3.</span> <span class="nav-text">双重检测机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="nav-number">2.4.</span> <span class="nav-text">静态内部类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE"><span class="nav-number">2.5.</span> <span class="nav-text">枚举</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88Builder%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">⭐建造者模式（Builder）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%A1%AB%E5%85%85%E5%92%8C%E6%A0%A1%E9%AA%8C"><span class="nav-number">3.1.</span> <span class="nav-text">数据填充和校验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Property%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">原型模式（Property）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%BC%93%E5%AD%98%E5%8A%9F%E8%83%BD"><span class="nav-number">4.1.</span> <span class="nav-text">实现缓存功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%EF%BC%88Proxy%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">⭐代理模式（Proxy）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">5.1.</span> <span class="nav-text">⭐静态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">5.2.</span> <span class="nav-text">⭐动态代理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%EF%BC%88Bridge%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">⭐桥接模式（Bridge）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E5%8A%9F%E8%83%BD"><span class="nav-number">6.1.</span> <span class="nav-text">⭐消息推送功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88Decoreator%EF%BC%89"><span class="nav-number">7.</span> <span class="nav-text">⭐装饰器模式（Decoreator）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%A2%9E%E5%BC%BA%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="nav-number">7.1.</span> <span class="nav-text">⭐增强登录功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88Adapter%EF%BC%89"><span class="nav-number">8.</span> <span class="nav-text">⭐适配器模式（Adapter）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%88%E5%8A%9F%E8%83%BD"><span class="nav-number">8.1.</span> <span class="nav-text">⭐数据聚合功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F%EF%BC%88Facade%EF%BC%89"><span class="nav-number">9.</span> <span class="nav-text">门面模式（Facade）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="nav-number">9.1.</span> <span class="nav-text">实现用户注册功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%EF%BC%88Compose%EF%BC%89"><span class="nav-number">10.</span> <span class="nav-text">⭐组合模式（Compose）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%AE%9E%E7%8E%B0%E7%BB%93%E6%9E%84%E6%A0%91"><span class="nav-number">10.1.</span> <span class="nav-text">⭐实现结构树</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%EF%BC%88Flyweight%EF%BC%89"><span class="nav-number">11.</span> <span class="nav-text">⭐享元模式（Flyweight）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%AE%9E%E7%8E%B0%E6%A3%8B%E7%9B%98%E6%B8%B8%E6%88%8F"><span class="nav-number">11.1.</span> <span class="nav-text">⭐实现棋盘游戏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88Observer%EF%BC%89"><span class="nav-number">12.</span> <span class="nav-text">⭐观察者模式（Observer）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%AE%9E%E7%8E%B0%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="nav-number">12.1.</span> <span class="nav-text">⭐实现注册功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="nav-number">12.2.</span> <span class="nav-text">⭐事件总线</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%EF%BC%88Template-Method%EF%BC%89"><span class="nav-number">13.</span> <span class="nav-text">⭐模板模式（Template Method）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="nav-number">13.1.</span> <span class="nav-text">⭐模板模式结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%EF%BC%88Strategy%EF%BC%89"><span class="nav-number">14.</span> <span class="nav-text">⭐策略模式（Strategy）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="nav-number">14.1.</span> <span class="nav-text">⭐策略模式结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%EF%BC%88Chain-Of-Responsibility%EF%BC%89"><span class="nav-number">15.</span> <span class="nav-text">⭐责任链模式（Chain Of Responsibility）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%AE%9E%E7%8E%B0%E8%BF%87%E6%BB%A4%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="nav-number">15.1.</span> <span class="nav-text">⭐实现过滤敏感信息功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%EF%BC%88Finite-State-Machine%EF%BC%89"><span class="nav-number">16.</span> <span class="nav-text">⭐状态模式（Finite State Machine）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E8%B6%85%E7%BA%A7%E9%A9%AC%E9%87%8C%E5%A5%A5%E6%B8%B8%E6%88%8F"><span class="nav-number">16.1.</span> <span class="nav-text">⭐超级马里奥游戏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88Iterator%EF%BC%89"><span class="nav-number">17.</span> <span class="nav-text">迭代器模式（Iterator）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%BF%AB%E7%85%A7%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">17.1.</span> <span class="nav-text">基于快照的迭代器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88Visitor-Pattern%EF%BC%89"><span class="nav-number">18.</span> <span class="nav-text">访问者模式（Visitor Pattern）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E5%92%8C%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD"><span class="nav-number">18.1.</span> <span class="nav-text">实现文件解析和压缩功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%EF%BC%88Memento%EF%BC%89"><span class="nav-number">19.</span> <span class="nav-text">备忘录模式（Memento）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8"><span class="nav-number">19.1.</span> <span class="nav-text">实现文本编辑器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%EF%BC%88Command%EF%BC%89"><span class="nav-number">20.</span> <span class="nav-text">命令模式（Command）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">20.1.</span> <span class="nav-text">基本结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%AD%90%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88Interpreter%EF%BC%89"><span class="nav-number">21.</span> <span class="nav-text">⭐解释器模式（Interpreter）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%E5%AE%9E%E7%8E%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="nav-number">21.1.</span> <span class="nav-text">⭐实现表达式解析器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Mediator%EF%BC%89"><span class="nav-number">22.</span> <span class="nav-text">中介模式（Mediator）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0UI%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">22.1.</span> <span class="nav-text">实现UI控制器</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rainy"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Rainy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rainy-zhang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rainy-zhang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:rainy_zhang@foxmail.com" title="E-Mail → mailto:rainy_zhang@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rainy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>















  

  

</body>
</html>
